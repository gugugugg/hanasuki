# ðŸŒ¸ Hanasuki (èŠ±å¥½ã) V9.0

![Python](https://img.shields.io/badge/Python-3.10%2B-blue)
![License](https://img.shields.io/badge/License-GPL%20v3-red)
![Architecture](https://img.shields.io/badge/Architecture-Microkernel-purple)
![Status](https://img.shields.io/badge/Status-Stable%20(Build%202026)-success)

> **"ä¸ä»…ä»…æ˜¯å¯¹è¯ï¼Œè€Œæ˜¯å…³äºŽè¿›åŒ–ã€‚"**
>
> Hanasuki æ˜¯ä¸€ä¸ªåŸºäºŽå¾®å†…æ ¸æž¶æž„ä¸ŽåŒè½¨è®°å¿†ç³»ç»Ÿçš„æ¨¡å—åŒ–æ™ºèƒ½ç®¡å®¶ã€‚å¥¹å…·å¤‡â€œè‡ªç ”ã€è‡ªçœã€æ¼”åŒ–â€çš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿé€šè¿‡æ„Ÿæ€§ä¸Žç†æ€§çš„åŒé‡é©±åŠ¨ï¼Œåœ¨æœ¬åœ°ç«¯æž„å»ºèµ·ä¸€å¥—å®Œæ•´çš„è®¤çŸ¥è¿›åŒ–é—­çŽ¯ã€‚

---

## ðŸ“– ç›®å½• (Table of Contents)

- [æ ¸å¿ƒæž¶æž„ (Core Architecture)](#-æ ¸å¿ƒæž¶æž„-core-architecture)
- [åŒè½¨è®°å¿†ç³»ç»Ÿ (Dual-Track Memory)](#-åŒè½¨è®°å¿†ç³»ç»Ÿ-dual-track-memory)
- [ç•Œé¢åè®®ï¼š1+N å¤šç»´æŒ‚è½½](#-ç•Œé¢åè®®1n-å¤šç»´æŒ‚è½½)
- [ç¡¬ä»¶é€‚é…ä¸Žæ˜¾å­˜ä¼˜åŒ–](#-ç¡¬ä»¶é€‚é…ä¸Žæ˜¾å­˜ä¼˜åŒ–)
- [å¿«é€Ÿå¼€å§‹ (Quick Start)](#-å¿«é€Ÿå¼€å§‹-quick-start)
- [å¼€å‘è€…æŒ‡å— (Developer Guide)](#-å¼€å‘è€…æŒ‡å—-developer-guide)
- [ä¸»æƒä¸Žåè®® (Sovereignty & License)](#-ä¸»æƒä¸Žåè®®-sovereignty--license)

---

## ðŸ—ï¸ æ ¸å¿ƒæž¶æž„ (Core Architecture)

Hanasuki é‡‡ç”¨é«˜åº¦è§£è€¦çš„ **å¾®å†…æ ¸ (Microkernel)** è®¾è®¡ï¼š

* **å†…æ ¸ (`main.py`)**: ä»…è´Ÿè´£èµ„æºè°ƒåº¦ã€ä¸Šä¸‹æ–‡ç®¡ç† (`_trim_history`) ä¸Žä¸»æƒæ ¡éªŒã€‚å®ƒä¸åŒ…å«å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚
* **æ¨¡å— (`modules/`)**: æ‰€æœ‰çš„èƒ½åŠ›ï¼ˆå¦‚å†™ä»£ç ã€æµè§ˆç½‘é¡µã€ç»˜å›¾ï¼‰å’Œç•Œé¢ï¼ˆå¦‚èŠå¤©çª—å£ã€ç›‘è§†å™¨ï¼‰å‡é€šè¿‡æ’ä»¶åŠ¨æ€æŒ‚è½½ã€‚
* **çƒ­åˆ‡æ¢ (Hot-Swap)**: æ”¯æŒåœ¨â€œæ—¥å¸¸äº¤äº’â€ä¸Žâ€œæ·±åº¦è‡ªç ”â€æ¨¡å¼é—´åŠ¨æ€é‡è½½æ¨¡åž‹ Profileï¼Œåœ¨ **RTX 5060** ä¸Šå®žçŽ° 4k åˆ° 16k ä¸Šä¸‹æ–‡çš„æ— ç¼åˆ‡æ¢ã€‚

---

## ðŸ§  åŒè½¨è®°å¿†ç³»ç»Ÿ (Dual-Track Memory)

ä¸ºäº†æ¨¡æ‹Ÿäººç±»çš„é•¿æœŸè®°å¿†ï¼ŒHanasuki æž„å»ºäº†ç›¸äº’ç‹¬ç«‹åˆå½¼æ­¤æ”¯æ’‘çš„åŒé‡å­˜å‚¨æ¨¡åž‹ï¼š

### 1. æ„Ÿæ€§è¯­ä¹‰è®°å¿† (Semantic Memory)
* **å¼•æ“Ž**: [LanceDB](https://lancedb.com/)
* **æœºåˆ¶**: å°†å¯¹è¯ç¢Žç‰‡è½¬åŒ–ä¸º 512 ç»´å‘é‡ã€‚å³ä½¿é¢å¯¹æ•°æœˆå‰çš„çç¢Žå¯¹è¯ï¼ŒAI ä¹Ÿèƒ½é€šè¿‡è¯­ä¹‰ç›¸ä¼¼åº¦çž¬é—´å”¤èµ·ç›¸å…³èƒŒæ™¯ (RAG)ã€‚
* **ç­–ç•¥**: é»˜è®¤ `limit=1` ç²¾å‡†æ£€ç´¢ï¼Œé˜²æ­¢é•¿æ–‡æœ¬å¹²æ‰°æ¨¡åž‹è¯­è¨€ä¸­æž¢ã€‚

### 2. ç†æ€§é€»è¾‘å›¾è°± (Logical Graph)
* **å¼•æ“Ž**: [NetworkX](https://networkx.org/)
* **æœºåˆ¶**: ä»Žå¯¹è¯ä¸­æå– `[TRIPLET: ä¸»ä½“, å…³ç³», å®¢ä½“]` æ ‡ç­¾ï¼Œæž„å»ºéžçº¿æ€§çš„çŸ¥è¯†å›¾è°±ã€‚
* **è¿›åŒ–**: é©±åŠ¨ AI åœ¨â€œè‡ªç ”æ¨¡å¼â€ä¸‹è‡ªä¸»å‘çŽ°é€»è¾‘æ–­å±‚ï¼Œå¹¶ä¸»åŠ¨å‘èµ·æœç´¢ä»¥ä¿®è¡¥çŸ¥è¯†ç½‘ç»œã€‚

---

## ðŸŽ¨ ç•Œé¢åè®®ï¼š1+N å¤šç»´æŒ‚è½½

å®¿ä¸»ç¨‹åº (`app_gui.py`) é‡‡ç”¨äº†å…¨æ–°çš„æ°´å¹³å¼¹æ€§å¸ƒå±€ï¼Œæ”¯æŒç•Œé¢çš„æ— é™æ¨ªå‘æ‰©å±•ï¼š

1.  **ä¸»äº¤äº’ç•Œé¢ (Main UI)**:
    * å æ®æ ¸å¿ƒä½ç½®çš„å¯¹è¯çª—å£ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·æŒ‡ä»¤ã€‚
    * é…ç½®æ ‡è¯†: `is_main: True`

2.  **å‰¯æ’ä»¶ä¾§è¾¹æ  (Sub UI Plugins)**:
    * æ”¯æŒå¹³æ»‘åŠ¨ç”»æŠ½æ‹‰çš„å®žæ—¶ç›‘è§†å™¨ã€‚
    * å¼€å‘è€…å¯è½»æ¾æŒ‚è½½â€œè¿›åŒ–ç›‘è§†å™¨â€ã€â€œæ˜¾å­˜åˆ†æžä»ªâ€æˆ–â€œçŸ¥è¯†å›¾è°±é¢„è§ˆå™¨â€ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨æŽ’åˆ—åœ¨ä¸»çª—å£å³ä¾§ã€‚
    * é…ç½®æ ‡è¯†: `is_main: False`

---

## âš™ï¸ ç¡¬ä»¶é€‚é…ä¸Žæ˜¾å­˜ä¼˜åŒ–

é’ˆå¯¹ä¸»æµ NVIDIA GPU ä¼˜åŒ–çš„æ˜¾å­˜åˆ†çº§æ–¹æ¡ˆ (åŸºäºŽ Llama-3 8B é‡åŒ–æ¨¡åž‹)ï¼š

| æ˜¾å­˜å®¹é‡ | æŽ¨èé‡åŒ–ç‰ˆæœ¬ | æ—¥å¸¸æ¨¡å¼ (n_ctx) | è‡ªå­¦æ¨¡å¼ (n_ctx) | ä¼˜åŒ–ç­–ç•¥ |
| :--- | :--- | :--- | :--- | :--- |
| **6GB** | Q4_K_M | 2048 | 4096 | é™åˆ¶ GPU å±‚æ•°ï¼Œå¯ç”¨ CPU æ··åˆè®¡ç®— |
| **8GB** | **Q6_K (æŽ¨è)** | **4096** | **16384** | **å…¨æ˜¾å­˜åŠ é€Ÿï¼Œæ”¯æŒé•¿ç¨‹æ£€ç´¢ä¸Žè‡ªç ”** |
| **12GB** | Q8_0 | 8192 | 32768 | æ·±åº¦é€»è¾‘é“¾åˆ†æžï¼Œæžé€Ÿå“åº” |
| **16GB+** | FP16 | 16384 | 65536+ | æžè‡´ä½“éªŒï¼Œæ”¯æŒ 14B+ ä¸­åž‹æ¨¡åž‹ |

---

## ðŸš€ å¿«é€Ÿå¼€å§‹ (Quick Start)

### 1. çŽ¯å¢ƒå‡†å¤‡
* Python 3.10+
* NVIDIA GPU (æŽ¨è) + CUDA Toolkit 12.x

### 2. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
playwright install chromium  # ç”¨äºŽç½‘é¡µè‡ªç ”æ¨¡å—
```

### 3. é…ç½®æ¨¡åž‹
1.  ä¸‹è½½ Llama-3 æˆ– Mistral ç³»åˆ—çš„ `.gguf` æ¨¡åž‹ã€‚
2.  ä¿®æ”¹ `config.yaml` ä¸­çš„ `model_path` æŒ‡å‘ä½ çš„æ¨¡åž‹æ–‡ä»¶ã€‚

### 4. å¯åŠ¨ç³»ç»Ÿ
```bash
python app_gui.py
```
*æ³¨æ„ï¼šé¦–æ¬¡å¯åŠ¨ä¼šè§¦å‘å†…æ ¸å®Œæ•´æ€§æ ¡éªŒï¼Œè¯·ç¡®ä¿ä»£ç æœªè¢«ç¯¡æ”¹ã€‚*

---

## ðŸ› ï¸ å¼€å‘è€…æŒ‡å— (Developer Guide)

Hanasuki çš„æ‰€æœ‰åŠŸèƒ½å‡ç”± `modules/` ç›®å½•ä¸‹çš„ Python è„šæœ¬é©±åŠ¨ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ‰©å±•ç³»ç»Ÿèƒ½åŠ›ï¼š

### 1. ç¼–å†™åŠŸèƒ½æ’ä»¶ (Utility Tools)
æ­¤ç±»æ’ä»¶èµ‹äºˆ AI å®žé™…æ“ä½œèƒ½åŠ›ï¼ˆå¦‚ï¼šæœç´¢ã€è®¡ç®—ã€ç»˜å›¾ï¼‰ã€‚
**æ¨¡æ¿è·¯å¾„**: `modules/my_tool.py`

```python
def get_spec():
    return {
        "name": "weather_tool",
        "description": "æŸ¥è¯¢æŒ‡å®šåŸŽå¸‚çš„å¤©æ°”æƒ…å†µ",
        "parameters": {
            "city": "åŸŽå¸‚åç§° (å¦‚: åŒ—äº¬)"
        }
    }

def run(params):
    city = params.get("city", "æœªçŸ¥")
    return f"{city} çš„å¤©æ°”æ˜¯æ™´æœ—ã€‚"
```

### 2. ç¼–å†™ç•Œé¢æ’ä»¶ (UI Extensions)
æ­¤ç±»æ’ä»¶ç”¨äºŽæ‰©å±• GUI ç•Œé¢ï¼ˆå¦‚ï¼šä¾§è¾¹æ ç›‘è§†å™¨ã€æ‚¬æµ®çƒï¼‰ã€‚
**æ¨¡æ¿è·¯å¾„**: `modules/my_sidebar.py`

```python
from PyQt6.QtWidgets import QLabel

def get_spec():
    return {
        "name": "system_monitor",
        "type": "ui_extension",
        "is_main": False  # [å…³é”®] False = ä¾§è¾¹æ ; True = ä¸»èŠå¤©çª—å£
    }

def get_ui_entry(parent_window, bot_instance):
    widget = QLabel("æˆ‘æ˜¯ä¾§è¾¹æ æ’ä»¶", parent_window)
    widget.setStyleSheet("background: red;")
    return widget
```

---

## ðŸ›¡ï¸ ä¸»æƒä¸Žåè®® (Sovereignty & License)

æœ¬é¡¹ç›®ä¸¥æ ¼éµå¾ª **GNU General Public License v3 (GPL v3)** åè®®ã€‚

* **èº«ä»½é”**: å†…æ ¸å†…ç½® `_verify_kernel_integrity` æ ¡éªŒé€»è¾‘ï¼ŒéªŒè¯ä»¤ç‰Œä¸º `6c6f766573616e67` (Hex è§£ç : `lovesang`)ã€‚
* **å¼ºåˆ¶ä¸­æ–‡**: ç³»ç»Ÿçº§ Prompt æ¤å…¥ä¸ŽåŠ¨æ€é”šç‚¹æŠ€æœ¯ï¼Œç¡®ä¿ AI åœ¨ä»»ä½•æƒ…å†µä¸‹å‡ä¼˜å…ˆä½¿ç”¨ä¸­æ–‡å›žå¤ã€‚
* **è¡ç”Ÿé™åˆ¶**: ä»»ä½•åŸºäºŽæœ¬é¡¹ç›®çš„äºŒæ¬¡å¼€å‘æˆ–åˆ†å‘ç‰ˆæœ¬ï¼Œ**å¿…é¡»**ä¿ç•™åŽŸä½œè€… `lovesang` çš„ç½²åï¼Œå¹¶**å¿…é¡»**å¼€æºã€‚

---

> **lovesang**: "ä»£ç æ˜¯æ„å¿—çš„å»¶ä¼¸ï¼Œé€»è¾‘æ˜¯ç”Ÿå‘½çš„è¶³è¿¹ã€‚"
> 
> *Copyright (c) 2026 lovesang. All Rights Reserved.*